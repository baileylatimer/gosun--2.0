!function(a,b){a=a||"docReady";var c=[],d=!1,e=!1;function f(){if(!d){d=!0;for(var a=0;a<c.length;a++)c[a].fn.call(window,c[a].ctx);c=[]}}function g(){"complete"===document.readyState&&f()}(b=b||window)[a]=function(a,b){if("function"!=typeof a)throw new TypeError("callback for docReady(fn) must be a function");d?setTimeout(function(){a(b)},1):(c.push({fn:a,ctx:b}),"complete"===document.readyState?setTimeout(f,1):e||(document.addEventListener?(document.addEventListener("DOMContentLoaded",f,!1),window.addEventListener("load",f,!1)):(document.attachEvent("onreadystatechange",g),window.attachEvent("onload",f)),e=!0))}}("flits_docReady",window),window.flitsApp&& void 0!==window.flitsApp||(window.flitsApp={}),window.flitsApp.formatMoney=function(a,e){"string"==typeof a&&(a=a.replace(".",""));var b="",_=/\{\{\s*(\w+)\s*\}\}/,d=e||"${{amount}}";function f(a,b){return void 0===a?b:a}function c(a,b,c,_){if(b=f(b,2),c=f(c,","),_=f(_,"."),isNaN(a)||null==a)return 0;var d=(a=(a/100).toFixed(b)).split(".");return d[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+c)+(d[1]?_+d[1]:"")}switch(d.match(_)[1]){case"amount":b=c(a,2);break;case"amount_no_decimals":b=c(a,0);break;case"amount_with_comma_separator":b=c(a,2,".",",");break;case"amount_no_decimals_with_comma_separator":b=c(a,0,".",",")}return d.replace(_,b)},window.flitsApp.credit_on_cart=function(){this.that=this,this.get_credit_url="/get_credit",this.apply_credit_url="/credit/apply_credit",this.div_code_class="flits-credit-code-div",this.flits_token="",this.customer_url="",this.cart_data={},this.get_ajax_obj=function(){return window.XMLHttpRequest?new XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):void 0},this.set_automatic_code=function(){["input[name='checkout']","button[name='checkout']","[href$='checkout']"].forEach(function(d){var a=document.querySelectorAll(d);if("object"==typeof a&&a)for(var c=0;c<a.length;c++){var b=a[c];if("function"!=typeof b.addEventListener)return;var e=document.getElementById("flits-cart-automatic-code").children[0].cloneNode(!0);b.parentElement.insertBefore(e,b.parentElement.firstChild),b.addEventListener("click",function(a){var b=this;window.flitsApp.credit_on_cart_obj.get_discount_code(a,b)},!1)}})},this.serialize=function(b){var c=[];for(var a in b)if(b.hasOwnProperty(a)){if("object"==typeof b[a]||"array"==typeof b[a])for(var d in b[a])c.push(encodeURIComponent(a+"["+d+"]")+"="+encodeURIComponent(b[a][d]));else c.push(encodeURIComponent(a)+"="+encodeURIComponent(b[a]))}return c.join("&")},this.parseHTML=function(a){if(!a)return document.createElement("div");var b=document.createElement("html");return b.innerHTML="<html><head><title>titleTest</title></head><body><div>"+a+"</div></body></html>",b.querySelector("body div")},this.generate_code=function(f){var b="$ {{ amount }}";document.querySelector("#flits-shop-money-format")&&(b=document.querySelector("#flits-shop-money-format").value);var g=f.total_credits,a=f.rules,e="";a.length>0&&(e+="<select name='flits-want-to-use-credit'><option value='-1'>"+window.flitsApp.multilang_cart.spent_rules.select_store_credit_option+"</option>");for(var c=0;c<a.length;c++){var h=a[c].applicable_credits,i=a[c].rule.id,d="You can use ##credits## credits out of ##total_credits##.";d="cart_value"===a[c].rule.rule.column.name?(d=window.flitsApp.multilang_cart.spent_rules.credit_cart_percentage.replace("##credits##",window.flitsApp.formatMoney(Math.abs(h),b).replace(/((\,00)|(\.00))$/g,""))).replace("##total_credits##",window.flitsApp.formatMoney(Math.abs(g),b).replace(/((\,00)|(\.00))$/g,"")):(d=d.replace("##credits##",window.flitsApp.formatMoney(Math.abs(h),b).replace(/((\,00)|(\.00))$/g,""))).replace("##total_credits##",window.flitsApp.formatMoney(Math.abs(g),b).replace(/((\,00)|(\.00))$/g,"")),e+="<option value='"+i+"'>"+d+"</option>"}return a.length>0&&(e+="</select>"),this.parseHTML(e)},this.get_code=function(a){var b=window.flitsApp.credit_on_cart_obj,g=b.customer_url+b.get_credit_url,c=b.get_ajax_obj();c.onreadystatechange=function(){if(4==this.readyState){if(200==this.status){var c=JSON.parse(this.responseText);if("0"!=c.is_credit_on_cart)for(var e=b.generate_code(c.code),d=document.querySelectorAll("."+b.div_code_class),a=0;a<d.length;a++)d[a].append(e.cloneNode(!0))}else error}},c.open("POST",g,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),Object.defineProperty(a,"cart_token",Object.getOwnPropertyDescriptor(a,"token")),delete a.token;for(var f=["sku","featured_image","product_description","title","url","handle","product_type","product_title","discounts","variant_options","options_with_values","variant_title"],d=0;d<a.items.length;d++)for(var e=0;e<f.length;e++)b.isNull(a.items[d][f[e]])||delete a.items[d][f[e]];var h=b.serialize({customer_hash:window.flitsApp.customer_hash,token:b.flits_token,cart:btoa(unescape(encodeURIComponent(JSON.stringify(a))))});c.send(h)},this.init=function(){this.customer_url=document.getElementById("flits-customer-url").value,this.flits_token=document.getElementById("flits-token").value,this.apply_credit_url=this.customer_url+this.apply_credit_url;var a=0;document.getElementById("flits-is-cart-automatic")&&(a=document.getElementById("flits-is-cart-automatic").value),1==a&&this.set_automatic_code(),this.getCartData(this.get_code,function(){console.error("cannot get cart data")})},this.getCookie=function(e){for(var c=e+"=",d=decodeURIComponent(document.cookie).split(";"),b=0;b<d.length;b++){for(var a=d[b];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(c))return a.substring(c.length,a.length)}return""},this.getCartData=function(b,c){var a=this.get_ajax_obj();a.onreadystatechange=function(){4==this.readyState&&(200==this.status?"function"==typeof b&&b(JSON.parse(this.responseText)):"function"==typeof c&&c())},a.open("GET","/cart.json",!0),a.send()},this.get_discount_code=function(c,a){var g=this,d=!1,b=a.closest("form").querySelector("[name='flits-want-to-use-credit']"),h=-1;if((d=!b||"select"!=b.tagName.toString().toLowerCase())&&b.checked)c.preventDefault();else{if(d||"-1"===b.value)return!0;h=b.value,c.preventDefault()}var e=a.innerHTML,f=window.flitsApp.multilang.applying_credit_message;"input"==a.tagName.toString().toLowerCase()?(e=a.value,a.value=f):(e=a.innerHTML,a.innerHTML=f),a.setAttribute("disabled",!0),g.getCartData(function(b){var i="/credit/apply_credit",k=document.getElementById("flits-token").value;i=document.getElementById("flits-customer-url").value+i;var c=g.get_ajax_obj();c.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var b=JSON.parse(this.responseText);"input"==a.tagName.toString().toLowerCase()?a.value=e:a.innerHTML=e,a.setAttribute("disabled",!1),b.status&&(location.href="/checkout?discount="+b.code)}},c.open("POST",i,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),Object.defineProperty(b,"cart_token",Object.getOwnPropertyDescriptor(b,"token")),delete b.token;for(var j=["sku","featured_image","product_description","title","url","handle","product_type","product_title","discounts","variant_options","options_with_values","variant_title"],d=0;d<b.items.length;d++)for(var f=0;f<j.length;f++)g.isNull(b.items[d][j[f]])||delete b.items[d][j[f]];var l=g.serialize({customer_hash:window.flitsApp.customer_hash,token:k,data:btoa(unescape(encodeURIComponent(JSON.stringify(b)))),spent_rule_id:h});c.send(l)},function(){location.href="/checkout"})},this.isNull=function(a){return void 0===a||null==a||""==a.toString().trim()},this.add_click_event=function(){$(document).on("click",'[name="checkout"]',function(a){window.flitsApp.credit_on_cart_obj.get_discount_code(a,this)})},this.init()},flits_docReady(function(){window.flitsApp.credit_on_cart_obj=new window.flitsApp.credit_on_cart})