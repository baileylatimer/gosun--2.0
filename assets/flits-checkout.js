window.flitsApp&& void 0!==window.flitsApp||(window.flitsApp={}),window.flitsApp.formatMoney=function(a,e){"string"==typeof a&&(a=a.replace(".",""));var b="",_=/\{\{\s*(\w+)\s*\}\}/,d=e||"${{amount}}";function f(a,b){return void 0===a?b:a}function c(a,b,c,_){if(b=f(b,2),c=f(c,","),_=f(_,"."),isNaN(a)||null==a)return 0;var d=(a=(a/100).toFixed(b)).split(".");return d[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+c)+(d[1]?_+d[1]:"")}switch(d.match(_)[1]){case"amount":b=c(a,2);break;case"amount_no_decimals":b=c(a,0);break;case"amount_with_comma_separator":b=c(a,2,".",",");break;case"amount_no_decimals_with_comma_separator":b=c(a,0,".",",")}return d.replace(_,b)},window.flitsApp.credit_on_shipping_method=function(){var b=this;if(this.customer_id="",this.customer_url="",this.token="",this.moneyFormat="",this.checkbox_format="",this.checkbox_div="",this.select_format="",this.store_credit_applied="",this.cart_data={},this.spent_rules={},this.applied_discount_code_span=".applied-reduction-code__information",document.querySelector(".reduction-code__text")&&(this.applied_discount_code_span=".reduction-code__text"),this.get_ajax_obj=function(){return window.XMLHttpRequest?new XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):void 0},this.serialize=function(a){var c=[];for(var b in a)a.hasOwnProperty(b)&&c.push(encodeURIComponent(b)+"="+encodeURIComponent(a[b]));return c.join("&")},this.generate_code=function(g){for(var b=this,e=b.money_format,h=g.total_credits,c=g.rules,d=0;d<c.length;d++){var i=c[d].applicable_credits,j=c[d].rule.id,a="You can use ##credits## credits out of ##total_credits##.";switch(c[d].rule.rule.column.name){case"cart_value":a=(a=b.spent_rules.credit_cart_percentage.replace("##credits##",window.flitsApp.formatMoney(Math.abs(i),e).replace(/((\,00)|(\.00))$/g,""))).replace("##total_credits##",window.flitsApp.formatMoney(Math.abs(h),e).replace(/((\,00)|(\.00))$/g,""));break;case"checkout_shipping":a=b.spent_rules.free_shipping_rule;break;default:a=(a=a.replace("##credits##",window.flitsApp.formatMoney(Math.abs(i),e).replace(/((\,00)|(\.00))$/g,""))).replace("##total_credits##",window.flitsApp.formatMoney(Math.abs(h),e).replace(/((\,00)|(\.00))$/g,""))}var f=document.createElement("option");f.value=j,f.innerHTML=a,b.select_format.querySelector('select option[value="'+j+'"]')||b.select_format.querySelector("select").appendChild(f)}c.length<=0&&(b.select_format.style.display="none")},this.add_checkbox_code=function(){if(document.querySelector("#flits-use-credit-div"));else for(var d=document.querySelectorAll('form input[name="checkout[reduction_code]"]'),a=0;a<d.length;a++){var c=d[a].closest("form");if(c){var e=b.checkbox_div.cloneNode(!0);c.parentElement.parentNode.insertBefore(e,c.parentElement.nextSibling)}}},this.getCookie=function(e){for(var c=e+"=",d=decodeURIComponent(document.cookie).split(";"),b=0;b<d.length;b++){for(var a=d[b];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(c))return a.substring(c.length,a.length)}return""},this.setCookie=function(b,c,d){var a=new Date;a.setTime(a.getTime()+864e5*d);var e="expires="+a.toUTCString();document.cookie=b+"="+c+";"+e+";path=/"},this.isNull=function(a){return void 0===a||null==a||""==a.toString().trim()},this.get_credit=function(i){var a=this,g=a.customer_url+"/get_credit";if(Shopify&&Shopify.Checkout.step==a.step_name){var c=a.get_ajax_obj();c.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var c=JSON.parse(this.responseText),b=document.createElement("div");if(b.id="flits-use-credit-div",b.style.marginBottom="1.5em",a.generate_code(c.code),a.checkbox_div=b,a.checkbox_div.append(a.select_format),1==c.is_credit_on_checkout){var d=a.getCookie("flits_discount_code"),e=document.querySelector(a.applied_discount_code_span);if(a.isNull(d)?a.add_checkbox_code():a.isNull(e)?a.add_checkbox_code():d==e.innerHTML||a.add_checkbox_code(),a.isNull(i));else{var f=i.step;switch(f){case"remove_code":var g=setInterval(function(){var a=window.flitsApp.credit_on_shipping_obj,b=document.querySelector(a.applied_discount_code_span),c=a.getCookie("flits_discount_code");a.isNull(b)?(clearInterval(g),a.add_checkbox_code()):c==b.innerHTML||(clearInterval(g),a.add_checkbox_code())},100);break;case"apply_code":var g=setInterval(function(){var a=window.flitsApp.credit_on_shipping_obj,b=document.querySelector(a.applied_discount_code_span);a.getCookie("flits_discount_code"),a.isNull(b)||(clearInterval(g),a.add_checkbox_code())},100)}}}}},c.open("POST",g,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded");var b=a.cart_data;a.isNull(b.token)||(Object.defineProperty(b,"cart_token",Object.getOwnPropertyDescriptor(b,"token")),delete b.token);for(var f=["sku","featured_image","product_description","title","url","handle","product_type","product_title","discounts","variant_options","options_with_values","variant_title"],d=0;d<b.items.length;d++)for(var e=0;e<f.length;e++)a.isNull(b.items[d][f[e]])||delete b.items[d][f[e]];var h=a.serialize({customer_hash:window.flitsApp.credit_on_shipping_obj.customer_hash,token:a.token,cart:btoa(unescape(encodeURIComponent(JSON.stringify(b)))),customer_id:a.customer_id,shipping_price:a.get_shipping_price()});c.send(h)}},this.get_shipping_price=function(){var a=document.querySelector("[data-checkout-total-shipping-target]");return a?a.getAttribute("data-checkout-total-shipping-target"):0},this.getCartData=function(b,c){var a=this.get_ajax_obj();a.onreadystatechange=function(){4==this.readyState&&(200==this.status?"function"==typeof b&&b(JSON.parse(this.responseText)):"function"==typeof c&&c())},a.open("GET","/cart.json",!0),a.send()},this.getFormData=function(e){for(var c=e.querySelectorAll("[name]"),d={},a=0;a<c.length;a++)d[c[a].name]=c[a].value;return b.serialize(d)},this.applyCreditClickEvent=function(){document.addEventListener("click",function(b){var c=b.target,d=c,f=window.flitsApp.credit_on_shipping_obj;if(c.classList.contains("apply-flits-credit")){var e=!1,a=c.closest("#flits-use-credit-div").querySelector("#flits-want-to-use-credit"),g=-1;if((e=!a||"select"!=a.tagName.toString().toLowerCase())&&a.checked)b.preventDefault();else{if(e||"-1"===a.value)return!0;g=a.value,b.preventDefault()}d.setAttribute("disabled",!0),d.classList.add("btn--loading"),f.getCartData(function(a){var h="/credit/apply_credit",j=f.token;h=f.customer_url+h;var b=f.get_ajax_obj();b.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var a=JSON.parse(this.responseText);if(d.setAttribute("disabled",!1),a.status){var b=document.querySelector('input[name="checkout[reduction_code]"]').cloneNode(!0);b.type="hidden",b.value=a.code,document.querySelector('input[name="checkout[reduction_code]"]').closest("form").appendChild(b),document.querySelector('input[name="checkout[reduction_code]"]').closest("form").submit(),d.querySelector(".btn__applied").style.display="inline-block",d.querySelector(".btn__spinner").style.display="none",d.querySelector(".btn__content").style.display="none",f.setCookie("flits_discount_code",a.code,3)}}},b.open("POST",h,!0),b.setRequestHeader("Content-type","application/x-www-form-urlencoded"),Object.defineProperty(a,"cart_token",Object.getOwnPropertyDescriptor(a,"token")),delete a.token;for(var i=["sku","featured_image","product_description","title","url","handle","product_type","product_title","discounts","variant_options","options_with_values","variant_title"],c=0;c<a.items.length;c++)for(var e=0;e<i.length;e++)f.isNull(a.items[c][i[e]])||delete a.items[c][i[e]];var k="token="+j+"&customer_hash="+window.flitsApp.credit_on_shipping_obj.customer_hash+"&data="+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+"&spent_rule_id="+g+"&shipping_price="+f.get_shipping_price();b.send(k)},function(){location.href="/checkout"})}}),document.addEventListener("submit",function(c){var b=c.target,a=window.flitsApp.credit_on_shipping_obj;return a.isNull(b.querySelector("#checkout_clear_discount"))||a.get_credit({step:"remove_code"}),a.isNull(b.querySelector("#checkout_reduction_code"))||a.get_credit({step:"apply_code"}),!0})},this.addEventToGoPaymentBtn=function(){if(document.querySelector('[data-trekkie-id="continue_to_payment_method_button"]')){var a=this.getCookie("flits_discount_code"),b=document.querySelector(this.applied_discount_code_span)?document.querySelector(this.applied_discount_code_span).innerHTML:null;a&&b&&b==a&&document.querySelector(".applied-reduction-code__clear-button")&&document.querySelector(".applied-reduction-code__clear-button").closest("form").submit()}},this.step_name="payment_method",Shopify&&Shopify.Checkout.step==this.step_name){var c=location.origin+"/?view=flits_customer_data",a=this.get_ajax_obj();a.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var d=this.responseText,c=new DOMParser().parseFromString(d,"text/html"),a=JSON.parse(c.querySelector(".flits-checkout-data").innerHTML),e=c.querySelector(".flits-checkout-checkbox").innerHTML,f=c.querySelector(".flits-checkout-select-credit-div");b.customer_id=a.customer_id,b.customer_url=a.customer_url,window.flitsApp.credit_on_shipping_obj.customer_hash=a.customer_hash,b.token=a.token,b.money_format=c.querySelector("#flits-money-format").value,b.checkbox_format=e,b.select_format=f,b.spent_rules=a.spent_rules,b.store_credit_applied=a.store_credit_applied,b.getCartData(function(b){var a=window.flitsApp.credit_on_shipping_obj;a.cart_data=b,a.get_credit(),a.applyCreditClickEvent()},function(){})}},a.open("GET",c,!0),a.send()}if(Shopify&&"shipping_method"==Shopify.Checkout.step&&b.addEventToGoPaymentBtn(),Shopify){var e=b.getCookie("flits_discount_code"),f=document.querySelector(b.applied_discount_code_span)?document.querySelector(b.applied_discount_code_span).innerHTML:null;if(e&&f&&f==e){var g=document.querySelector(".total-line-table "+b.applied_discount_code_span).parentNode,d=document.createElement("span");d.innerHTML="Store Credit Applied",d.className="flits-store-credit-information",g.appendChild(d),document.querySelector(".total-line-table "+b.applied_discount_code_span).style.display="none";var c=location.origin+"/?view=flits_customer_data",a=this.get_ajax_obj();a.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var a=this.responseText,c=new DOMParser().parseFromString(a,"text/html"),g=JSON.parse(c.querySelector(".flits-checkout-data").innerHTML);d.innerHTML=g.store_credit_applied,setInterval(function(){if(e&&f&&f==e&&document.querySelector(".total-line-table "+b.applied_discount_code_span)){var c=document.querySelector(".total-line-table "+b.applied_discount_code_span).parentNode;if(!c.querySelector(".flits-store-credit-information")){var a=document.createElement("span");a.innerHTML=g.store_credit_applied,a.className="flits-store-credit-information",c.appendChild(a),document.querySelector(".total-line-table "+b.applied_discount_code_span).style.display="none"}}},100)}},a.open("GET",c,!0),a.send()}}},window.flitsApp.credit_on_shipping_obj=new window.flitsApp.credit_on_shipping_method